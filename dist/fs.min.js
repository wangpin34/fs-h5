"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(){function e(e,r){var n=[],t=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(t=(a=u.next()).done)&&(n.push(a.value),!r||n.length!==r);t=!0);}catch(l){i=!0,o=l}finally{try{!t&&u["return"]&&u["return"]()}finally{if(i)throw o}}return n}return function(r,n){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}(),_Constants=require("./Constants"),_ErrorHandler=require("./ErrorHandler"),_ErrorHandler2=_interopRequireDefault(_ErrorHandler),DEFAULT_SIZE=10485760,FS=null,initialized=!1,initializing=!1,fs=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"isReady",value:function(){return initialized}},{key:"requestQuota",value:function(){var e=arguments.length<=0||void 0===arguments[0]?_Constants.Default.DEFAULT_SIZE:arguments[0];return new Promise(function(r,n){navigator.webkitPersistentStorage.requestQuota(e,function(e){r(e)},function(e){var r=_ErrorHandler2["default"].on(e,"request quota");n({err:e,msg:r})})})}},{key:"init",value:function(){var e=arguments.length<=0||void 0===arguments[0]?DEFAULT_SIZE:arguments[0],r=arguments.length<=1||void 0===arguments[1]?window.TEMPORARY:arguments[1];return new Promise(function(n,t){initializing||(initializing=!0,initialized=!1,(window.requestFileSystem||window.webkitRequestFileSystem)(r,e,function(e){FS=e,initializing=!1,initialized=!0,n(e)},function(e){var r=_ErrorHandler2["default"].on(e,"init file system");t({err:e,msg:r})}))})}},{key:"existsPath",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return Promise.all([new Promise(function(r,n){FS.root.getDirectory(e,{},function(e){r({exists:!0,dirEntry:e})},function(n){if(n.code===_Constants.FileError.NOT_FOUND_ERR||n.code===_Constants.FileError.TYPE_MISMATCH)r({exists:!1});else{var t=_ErrorHandler2["default"].on(n,"check whether dir "+e+" exists");r({msg:t})}})}),new Promise(function(r,n){FS.root.getFile(e,{},function(e){r({exists:!0,fileEntry:e})},function(n){if(n.code===_Constants.FileError.NOT_FOUND_ERR||n.code===_Constants.FileError.TYPE_MISMATCH)r({exists:!1});else{var t=_ErrorHandler2["default"].on(n,"check whether file"+e+" exists");r({msg:t})}})})]).then(function(e){var r=_slicedToArray(e,2),n=r[0],t=r[1];if(n.exists||t.exists)return!0;if(n.exists===!1||t.exists===!1)return!1;throw new Error(n.msg+" "+t.msg)})}},{key:"mkdir",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return new Promise(function(r,n){var t=e.split("/").filter(function(e){return""!==e&&"."!==e}),i=function o(t,i){var a=i||FS.root;"."!=t[0]&&""!=t[0]||(t=t.slice(1)),a.getDirectory(t[0],{create:!0},function(e){t.length>1?o(t.slice(1),e):r(e)},function(r){var t=_ErrorHandler2["default"].on(r,"create dir "+e);n({err:r,msg:t})})};i(t)})}},{key:"rmdir",value:function(e,r){return new Promise(function(n,t){FS.root.getDirectory(e,{},function(i){r.recursive?i.removeRecursively(function(){n()},function(r){var n=_ErrorHandler2["default"].on(r,"remove dir "+e);t({err:r,msg:n})}):i.remove(function(){n()},function(r){var n=_ErrorHandler2["default"].on(r,"remove dir "+e);t({err:r,msg:n})})})})}},{key:"writeFile",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],r=arguments.length<=1||void 0===arguments[1]?"":arguments[1];return new Promise(function(n,t){var i=function(r){var n=_ErrorHandler2["default"].on(r,"write to file "+e);t({err:r,msg:n})};FS.root.getFile(e,{create:!0},function(e){e.createWriter(function(e){var t=new Blob([r]);e.write(t),e.length>r.length&&setTimeout(function(){e.truncate(r.length)},10),e.onwriteend=function(){n()},e.onerror=i},i)},i)})}},{key:"appendFile",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],r=arguments.length<=1||void 0===arguments[1]?"":arguments[1];return new Promise(function(n,t){var i=function(r){var n=_ErrorHandler2["default"].on(r,"read from file "+e);t({err:r,msg:n})};FS.root.getFile(e,{},function(e){e.createWriter(function(e){e.seek(e.length);var t=new Blob([r]);e.write(t),e.onwriteend=function(){n()},e.onerror=i},i)},i)})}},{key:"readFile",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return new Promise(function(r,n){var t=function(r){var t=_ErrorHandler2["default"].on(r,"read from file "+e);n({err:r,msg:t})};FS.root.getFile(e,{},function(e){e.file(function(e){var n=new FileReader;n.onloadend=function(e){r(e.target.result)},n.readAsText(e)},t)},t)})}},{key:"rmFile",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return new Promise(function(r,n){var t=function(r){var t=_ErrorHandler2["default"].on(r,"remove file "+e);n({err:r,msg:t})};FS.root.getFile(e,{create:!1},function(e){e.remove(function(){r()},t)},t)})}},{key:"list",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return new Promise(function(r,n){var t=function(r){var t=_ErrorHandler2["default"].on(r,"list entries under "+e);n({err:r,msg:t})};FS.root.getDirectory(e,{},function(e){var n=e.createReader(),i=[],o=function a(){n.readEntries(function(e){e.length?(i=i.concat(e),a()):r(i)},t)};o()})})}}]),e}();exports["default"]=fs;
//# sourceMappingURL=fs.min.js.map
